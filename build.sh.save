cat > build.sh << 'EOF'
#!/bin/bash
# ============================================================================
# UnifiedVol Build Script (GCC + Ninja + vcpkg)
# ============================================================================
set -e

BUILD_TYPE=${1:-release}          # default: release
BUILD_DIR="build-${BUILD_TYPE}"

case "$(echo "$BUILD_TYPE" | tr '[:upper:]' '[:lower:]')" in
  release) CMAKE_BUILD_TYPE="Release" ;;
  debug)   CMAKE_BUILD_TYPE="Debug"   ;;
  *) echo "Usage: ./build.sh [release|debug]"; exit 1 ;;
esac

echo "🛠️  Building UnifiedVol ($CMAKE_BUILD_TYPE) with GCC..."

mkdir -p "$BUILD_DIR"
cd "$BUILD_DIR"

cmake .. -G Ninja \
  -DCMAKE_BUILD_TYPE="$CMAKE_BUILD_TYPE" \
  -DCMAKE_TOOLCHAIN_FILE=~/vcpkg/scripts/buildsystems/vcpkg.cmake \
  -DCMAKE_CXX_COMPILER=g++ \
  -DCMAKE_CXX_FLAGS="-O3 -march=native -ffast-math -fdiagnostics-color=always"

cmake --build . -j"$(nproc)"

EXE="./unifiedvol_example"
if [[ -f "$EXE" ]]; then
  echo "🚀 Running unifiedvol_example..."
  "$EXE"
else
  echo "⚠️  unifiedvol_example not found (maybe UNIFIEDVOL_BUILD_EXAMPLE=OFF?)"
fi

echo "✅ Build finished."
EOF
